/**
 * grid
 * @author Jason.Wang
 * @since 2013-6-31
 * 依赖jQuery
 */
!function(t){"use strict"
    function i(){return r++,r}function e(t,i){var e,r=[25,50,100],a={gridWidth:600,gridHeight:500,tableWidth:600,primaryKey:"ID",wrap:!1,headerWrap:!1,adaptive:!0,oddEvenRow:!0,selectType:"multi",fixedColSize:0,config:null,datasource:null,titleRender:null,colHidden:!1,colMove:!1,colWidthChange:!1,loadTip:!0,resizeHeight:null,resizeWidth:null,rowStyleRender:null,cellStyleRender:null,cellRender:null,lazy:!0,sortColSize:1,sortName:[],sortType:[],pageNo:1,recordSize:50,recordSizeList:r,pagination:!0,addDataCallback:null,removedataCallback:null,rowClickCallback:null,loadCompleteCallback:null,selectAllCallback:null,rowDblclickCallback:null,onStateChange:null}
        for(e in t)a.hasOwnProperty(e)&&(s.type(a[e])===s.type(t[e])||null===a[e]&&"function"==typeof t[e])&&(a[e]=t[e])
        a.el=i,a.recordSizeList.length<3&&(a.recordSizeList=r),this.options=a}var s=t.$,r=0
    s.grid||(t.jQuery.fn.grid=function(t){var i
        if(this.length)return this.data("gridObj")?this.data("gridObj"):(i=new e(t,this),this.data("gridObj",i),i._init(),i)},e.prototype={constructor:e,formatFn:{date:function(t,i){function e(t){return t.charAt(1)?t:0+t}if(!t)return""
        var r=s.type(t)
        if("string"===r||"number"===r){var a=new Date
            if(a.setTime(t),isNaN(a.getDate()))return t
            t=a}for(var o=["y+","yyyy","M","MM","d","dd","h","hh","m","mm","s","ss"],h=""+t.getFullYear(),d=""+(t.getMonth()+1),n=""+t.getDate(),l=""+t.getHours(),c=""+t.getMinutes(),g=""+t.getSeconds(),p=[h.slice(2),h,d,e(d),n,e(n),l,e(l),c,e(c),g,e(g)],u=o.length;u--;)i=i.replace(RegExp(o[u]),p[u])
        return i},money:function(t,i){"string"!=typeof t&&"number"!=typeof t&&(t=0),i=void 0===i?2:i
        var e,s,r,a,o,h,d,n,l="",c=!1,g=1
        for(/-/.test(t+"")&&(c=!0,t=(t+"").replace("-","")),s=0;i>s;s++)l+="0",g=10*g
        for(t=parseFloat(t,10)||0,t=(""+Math.round(t*g)/g).split("."),o=t[0],h=(t[1]||""+l).slice(0,i),r=o.length,d=r%3,n=d?[o.slice(0,d)]:[],e=0,a=Math.floor(r/3);a>e;e+=1)n.push(o.slice(d+3*e,d+3*e+3))
        if(h.length<i)for(s=0,r=h.length;i-r>s;s++)h+="0"
        return(c?"-":"")+n.join(",")+(i>0?".":"")+h}},renderMethod:{a:function(t,i,e){var s=["<a"],r=i.params,a=""
        if(r){r=r.split(";")
            for(var o=[],h=r.length;h--;){var d=r[h]
                t.hasOwnProperty(d)&&o.push(d+"="+t[d])}a="?"+o.join("&")}return s.push(" href='",(i.url||"")+a,"' class='",i.className||"","' target='",i.targets||"-self","' clickid='",i.click,"'>",e,"</a>"),s.join("")},image:function(t,i,e){var s=["<img"]
        s.push(" class='",i.className||"")
        var r=i.url,a=i.compare,o=i.relation,h=i.title,d=e
        if("string"==typeof o)if(/\./.test(o)){var n=o.split(".")
            d=t[n[0]][n[1]]}else d=t[o]
        return h=h&&h[d]?h[d]:e,a&&(r=a[d]||r),s.push("' src='",r,"' title='",h,"' clickid='",i.click,"' />"),s.join("")},button:function(t,i,e){var s=["<button class='"]
        return s.push(i.className||"","' clickid='",i.click,"'>",i.value||e,"</button>"),s.join("")}},_init:function(){var t=this.options,e=t.config,r=t.onStateChange,a=t.datasource,o=t.sortColSize=t.sortColSize||1
        t.sortName.length=Math.min(t.sortName.length,o),t.sortType.length=Math.min(t.sortType.length,o),"string"==typeof e&&"function"==typeof window[e]&&(t.config=window[e]),"string"==typeof r&&"function"==typeof window[r]&&(t.onStateChange=window[r]),"string"==typeof a&&"function"==typeof window[a]&&(t.datasource=window[a]),this.el=t.el,this.elCache=null,this.gridContainer=null,this.gridBox=null,this.gridStyle=null,this.gridHead=null,this.gridHeadTable=null,this.gridTableHide=null,this.gridBody=null,this.gridTableBox=null,this.gridTbody=null,this.gridScroll=null,this.gridLine=null,this.gridEmpty=null,this.gridTfoot=null,this.loading=null,this.gridOverlay=null,this.gridAllCheck=null,this.createDomBox=document.createElement("div"),this.domTh=[],this.domTr=[],this.domTd=[],this.domFixed=[],this.domHeadCol=[],this.domBodyCol=[],this.theadMap=[],this.extendTh=[],this.trFrag=document.createElement("tbody"),this.data=[],this.backupQuery=null,this.query=null,this.customQuery=null,this.rowSize=0,this.colSize=0,this.sortDict={},this.theadText=[],this.colStyle=[],this.colRender=[],this.bindName=[],this.bindDotName=[],this.numCol=0/0,this.colWidth=[],this.initColWidth=[],this.colWidthBackup=[],this.multiChecked=[],this.multiCheckedNum=0,this.singleChecked=0/0,this.fixedFnClick=[],this.colHidden=[],this.totalSize=0,this.guid="grid-"+i(),this.heightLight=[],this.colIndex=[],this.gridWidth=0,this.gridHeight=0,this.tableWidth=0,this.theadHeight=31,this.boxHeight=0,this.paginationHeight=t.pagination?41:0,this.selectrowsClass="",this.tdsPackage=[],this.endRow=0,this.trStart=0,this.trEnd=0,this.renderComplete=!1,this.odd=!1,this.unRender=!0,this.autoHeight=!1,this.isIttab=!1,this.arrIndex=Array.prototype.indexOf,this.persistence="function"==typeof r&&"function"==typeof e,this.oddEvenClass="grid-odd-row",this.selectedRowClass="grid-selected-row"
        try{var h=s("head")
            h.append('<style type="text/css"></style>'),h.find("style").last()[0].innerHTML="",this.writeStyle=!0}catch(d){this.writeStyle=!1}this._backupQuery(),this._setRecordSize(),this._setSortTypeObj(),this.__getDomTh(),this.__initWidthAndHeight(),this._create()},_backupQuery:function(){var t=this.options,i={recordSize:t.recordSize,pageNo:t.pageNo,sortName:s.extend([],t.sortName),sortType:s.extend([],t.sortType)}
        this.backupQuery=s.extend(!0,{},i),this.query=i},_setRecordSize:function(){for(var t=this.options,i=this.query,e=t.recordSizeList,s=i.recordSize,r=e.length;r--;)if(s===e[r])return
        i.recordSize=e[1]},_setSortTypeObj:function(){for(var t=this.query,i=t.sortName,e=t.sortType,s=i.length,r=this.sortDict={},a=0;s>a;a+=1){var o=e[a].toUpperCase()
        e[a]=o,r[i[a]]=o}},__getDomTh:function(){var t,i,e,r=this.el,a=this.colIndex,o=this.extendTh
        if(t=s(document.createElement("div")).html("<table><thead>"+(r.find("thead").html()||r.find("tbody").html()||r.html())+"</thead></table>").find("table").eq(0),this.elCache=t,i=t.find("tr"),e=i.length,1===e){for(var h=t[0].getElementsByTagName("th"),d=[],n=0,l=h.length;l>n;n+=1)d.push(h[n]),a[n]=n
            this.domTh=d}else{var c,g,p,u,f=this.theadMap=[]
            for(c=0;e>c;c+=1){var m=i.eq(c)[0],v=m.cells,y=v.length,b=0
                for(o[c]=[],f[c]||(f[c]=[]),g=0;y>g;g+=1){var C=v[g],_=C.colSpan
                    for(p=0;_>p;p+=1)f[c][b+p]=C
                    b+=_}var T=document.createElement("th")
                T.className="grid-empty-th",m.insertBefore(T,v[0])}for(c=e;c--;){var w=f[c],x=w.length
                for(g=0;x>g;g+=1){var S=w[g],k=S.rowSpan
                    if(k>1&&!o[c][g])for(k+=c,p=c+1;k>p;p+=1)u=f[p],u&&(o[p][g]=!0,u.splice(g,0,S))}}this.domTh=s.extend([],f[e-1])}this.colSize=this.domTh.length},__initWidthAndHeight:function(){var t=this.options,i="function"==typeof t.resizeWidth?t.resizeWidth():void 0,e="function"==typeof t.resizeHeight?t.resizeHeight():void 0,s=t.gridWidth,r=t.gridHeight
        this.gridWidth=(i||s)-2,"auto"===r&&(r=500,this.autoHeight=!0),this.gridHeight=(e||r)-2,this.theadHeight=30*this.elCache.find("tr").length+1,this.boxHeight=this.gridHeight-this.paginationHeight-this.theadHeight-1,this.tableWidth=t.adaptive?this.gridWidth-17:t.tableWidth||this.gridWidth},_create:function(){this.__createLayoutDom(),this.__theadClickEventBind(),this.__theadMouseEventBind(),this.__tbodyClickEventBind(),this.__tbodyMouseEventBind(),this.__imitateScroll(),this._resizeEventBind(),this.__boxScrollEventBind(),this._setStyleWidth(),this._setStyleHeight(),this._loading("show")
        var t=this.options,i=t.datasource,e=t.config
        "function"==typeof i&&(this.persistence?e(this):(this._createPropertys(),this._createContent(),i(this,this.getQuery())))},__createLayoutDom:function(){var t=this.options,i=this.el,e=document.createElement("div")
        e.className="grid-container"
        var r=['<div class="grid-style"></div>','<div class="grid-box">','<div class="grid-head">','<table class="grid-head-table"></table>',"</div>",'<div class="grid-body">','<div class="grid-empty">本列表暂无记录</div>','<div class="grid-table-box"><div class="grid-table-hide"></div></div>',"</div>",'<div class="grid-scroll">',"<div></div>","</div>",'<div class="grid-line"></div>','<div class="grid-overlay"></div>',"</div>",'<div class="grid-tfoot"></div>','<div class="grid-loading-bg grid-loading-bg-over"></div>','<div class="grid-loading-box"><span>正在加载...</span></div>']
        e.innerHTML=r.join(""),i[0].parentNode.insertBefore(e,i[0])
        var a=this.gridContainer=s(e).addClass(this.guid)
        this.gridTableBox=s(".grid-table-box",a)
        var o=this.gridBox=a.children(".grid-box")
        this.gridStyle=a.find(".grid-style").eq(0),this.gridHead=o.find(".grid-head").eq(0),this.gridBody=o.children(".grid-body").eq(0),this.gridOverlay=o.children(".grid-overlay").eq(0),this.gridHeadTable=this.gridHead.children(".grid-head-table").eq(0),this.gridLine=o.children(".grid-line").eq(0),this.gridScroll=o.children(".grid-scroll").eq(0),this.gridTfoot=a.children(".grid-tfoot").eq(0),this.gridEmpty=this.gridBody.children(".grid-empty").eq(0),this.loading=a.children(".grid-loading-bg").next().andSelf(),this.gridTableHide=s(".grid-table-hide",a).eq(0).append(i.addClass("grid-body-table")),t.wrap||i.addClass("grid-ellipsis"),t.headerWrap||this.gridHeadTable.addClass("grid-ellipsis")},__theadClickEventBind:function(){var t=this.options,i=this.bindName,e=this
        this.gridHeadTable.on("click",function(r){r.stopPropagation()
            var a=s(r.target),o=a.attr("class")
            if("grid-select"!==o&&"grid-ittab"!==o)if(a.hasClass("grid-all-checkbox")){var h=e.domTr,d=e.multiChecked,n=e.selectedRowClass,l="grid-all-checkbox-checked",c=e.endRow,g=e.rowSize,p=e.multiCheckedNum===g
                if(p){for(var u=c;u--;)d[u]=!1,s(h[u]).removeClass(n)
                    a.removeClass(l)
                    for(var f=c;g>f;f+=1)d[f]=!1
                    e.multiCheckedNum=0}else{for(var m=c;m--;)d[m]=!0,s(h[m]).addClass(n)
                    a.addClass(l)
                    for(var v=c;g>v;v+=1)d[v]=!0
                    e.multiCheckedNum=g}var y=t.selectAllCallback
                if("function"==typeof y){var b=!p
                    y.call(e,b?e.data:[],b)}}else{var C=a.parents(".grid-sort")
                if(C.length&&"grid-thead-text"===o){var _=e.sortDict,T=i[e._thIndex(C[0])],w=_[T],x="DESC"!==w?"DESC":"ASC"
                    e._setOptsSortNameAndSoryType(T,x),e.persistence&&e._triggerStatusChange(),e.loadData()}}})},_thIndex:function(t){var i=this.domTh,e=this.arrIndex
        if(e)return e.call(i,t)
        for(var s=this.colSize;s--;)if(i[s]===t)return s
        return-1},_setOptsSortNameAndSoryType:function(t,i){for(var e=this.query,s=this.options.sortColSize,r=e.sortName,a=e.sortType,o=s;o--;)if(t===r[o]){a.splice(o,1),r.splice(o,1)
        break}r.length===s&&(a.shift(),r.shift()),r.push(t),a.push(i),this._setSortTypeObj()},__theadMouseEventBind:function(){this.gridHeadTable.on("mouseover",function(t){var i=s(t.target),e=i.closest(".grid-fixed-s").eq(0)
        e.length&&e.parents("th").addClass("grid-thead-mouseover")}).on("mouseout",function(t){var i=s(t.target),e=i.closest(".grid-fixed-s").eq(0)
            e.length&&e.parents("th").removeClass("grid-thead-mouseover")})},__tbodyClickEventBind:function(){function t(t){if("none"!==a&&(o._selectRows(t,void 0),"function"==typeof e.rowClickCallback)){var i=!1
        "multi"===a&&(i=o.multiChecked[t]),"single"===a&&(i=t===o.singleChecked),e.rowClickCallback.call(o,o.data[t],i,t)}}var i,e=this.options,r="function"==typeof e.rowDblclickCallback?e.rowDblclickCallback:null,a=e.selectType,o=this,h=null,d=null
        o.el.on("click",function(e){if(e.stopPropagation(),d=e.target,i=d.tagName,"TBODY"!==i&&"TABLE"!==i){var a=s(d).closest("tr").eq(0),n=a.attr("index")||a[0].rowIndex-1+o.trStart,l=d.getAttribute("clickid")||"",c=RegExp(i,"i")
            return c.test("a;button;img")?(""!==l&&o.fixedFnClick[l](o.data[n],n),void 0):(c.test("input")||(r?(clearTimeout(h),h=setTimeout(function(){t(n)},300)):t(n)),void 0)}}),o.el.on("dblclick",function(t){if(t.stopPropagation(),r){if(clearTimeout(h),d=t.target,i=d.tagName,"TBODY"===i||"TABLE"===i)return
            var e=s(d).closest("tr").eq(0),a=e.attr("index")-0
            r.call(o,o.data[a],a)}})},_selectRows:function(t,i){var e=this.domTr,r=e[t],a=this.options,o=a.selectType,h=this.selectedRowClass,d=s(r)
        if("multi"===o){var n=this.multiChecked,l=n[t]
            if(void 0===i)i=l!==!0
            else if(i===l)return
            if(n[t]=i,!r)return
            i===!1?(d.removeClass(h),this.multiCheckedNum--,this.gridAllCheck.removeClass("grid-all-checkbox-checked")):(d.addClass(h),this.multiCheckedNum+=1,this.multiCheckedNum===this.rowSize&&this.gridAllCheck.addClass("grid-all-checkbox-checked"))}else if("single"===o){var c=this.singleChecked
            if(this.singleChecked=c===t&&i===!1?0/0:t,!r)return
            i===!1?d.removeClass(h):(isNaN(c)||s(e[c]).removeClass(h),d.addClass(h))}},__tbodyMouseEventBind:function(){var t,i,e=this,r=this.bindName,a=this.options.titleRender
        e.el.on("mouseover",function(o){var h=o.target,d=h.tagName
            if("TR"!==d&&"TBODY"!==d&&"TABLE"!==d){var n=s(h).closest("td")
                if(n.length){var l,c=n[0].cellIndex,g=n.find(".grid-fixed-s"),p=g.length?g:n,u=r[c]
                    t&&t.removeClass("grid-tr-over"),t=n.closest("tr"),l=t.attr("index"),l||(l=t[0].rowIndex-1+e.trStart,t.attr("index",l)),t.addClass("grid-tr-over"),"number"==typeof u||n.attr("title")||("function"==typeof a?(i=a(e.data[l],u),i?n.attr("title",i):(i=s.trim(p.text()),i&&n.attr("title",i))):(i=s.trim(p.text()),i&&n.attr("title",i)))}}}),e.el.on("mouseout",function(){t&&t.removeClass("grid-tr-over")})},__imitateScroll:function(){var t,i,e=this,s=e.guid,r=this.gridHeadTable[0],a=this.gridStyle[0],o=this.el[0],h=this.options.fixedColSize
        this.writeStyle?this.gridScroll.on("scroll",function(){t=this.scrollLeft,i!==t&&(i=t,a.innerHTML='<style type="text/css">.'+s+" .grid-fixed .grid-fixed-s{left:"+t+"px}."+s+" .grid-body-table, ."+s+" .grid-head-table{margin-left:-"+t+"px}</style>")}):this.gridScroll.on("scroll",function(){if(t=this.scrollLeft+"px",i!==t){i=t
            var s="-"+t
            r.style.marginLeft=s,o.style.marginLeft=s
            for(var a=e.domFixed,d=a.length;d--;)for(var n=a[d],l=h;l--;)n[l].style.left=t
            for(var c=e.tdsPackage,g=0;h>g;g+=1)c[g].html=c[g].html.replace(/(style="left:)\d*?px/,"$1"+t)}})},_resizeEventBind:function(){var t=this.options,i=this;(t.resizeHeight||t.resizeWidth)&&s(window).on("resize",function(){i.resize()})},resize:function(){var t=this.options
        try{var i=t.resizeHeight()
            "number"==typeof i&&i>0&&this._setHeight(i)}catch(e){}try{var s=t.resizeWidth()
            "number"==typeof s&&s>0&&this.setWidth(s)}catch(e){}},__boxScrollEventBind:function(){var t=this
        this.options.lazy&&!this.autoHeight&&this.gridBody.on("scroll",function(){t._lazyload(!0)})},_lazyload:function(t){var i=this,e=this.options,s=this.gridBody[0].scrollTop,r=i.endRow,a=parseInt(s/28,10),o=parseInt(this.boxHeight/28,10)+a+20+1
        e.wrap?!this.renderComplete&&this.appendRowsComplete&&o>r&&(clearTimeout(this.renderTimeout),t?this.renderTimeout=setTimeout(function(){i.appendRowsComplete=!1,i._appendRows(r,o)},10):(i.appendRowsComplete=!1,i._appendRows(r,o))):(clearTimeout(this.renderTimeout),t?this.renderTimeout=setTimeout(function(){i._clearAndLoad(a-20,r,o)},10):i._clearAndLoad(a-20,r,o))},_clearAndLoad:function(t,i,e){var s,r=this.rowSize,a=this.gridTbody[0],o=this.gridTableBox[0].style,h=this.trFrag,d=this.trStart,n=this.trEnd
        e=this.trEnd=Math.min(r,e),t=this.trStart=Math.max(t,0)
        var l,c,g,p
        if(e>i){var u=this._dataToDom(this.data,i,e),f=u.domTr
            for(this.domTr=this.domTr.concat(f),this.domTd=this.domTd.concat(u.domTd),this.domFixed=this.domFixed.concat(u.domFixed),this.endRow=e,p=f.length;p--;)h.appendChild(f[p])}if(s=this.domTr,t>d||e>n){for(l=d,c=Math.min(n,t);c>l;l++)h.appendChild(s[l])
            for(g=Math.max(t,n);e>g;g++)a.appendChild(s[g])}else if(d>t){var m=s[d]
            for(l=t,c=Math.min(d,e);c>l;l++)a.insertBefore(s[l],m)
            for(g=Math.max(d,e);n>g;g++)h.appendChild(s[g])}o.paddingTop=28*t+"px",o.paddingBottom=28*(r-e)+"px"},_setStyleWidth:function(){this.gridContainer.css("width",this.gridWidth),this.el.css("width",this.tableWidth),this.gridHeadTable.css("width",this.tableWidth)},_setStyleHeight:function(){this.gridContainer.css("height",this.gridHeight),this.gridHead.css("height",this.theadHeight-1),this.gridOverlay.css("height",this.theadHeight),this.gridBody.css("height",this.boxHeight)},_loading:function(t){this.options.loadTip&&(this.loading[t](),this.unRender&&"hide"===t&&this.gridContainer.find(".grid-loading-bg").removeClass("grid-loading-bg-over"))},_createPropertys:function(){this.__getTagsPropertys(),this.__initColWidth()},_createContent:function(){this.__renderHead(),this.__renderBody(),this._setColWidthStyle(),this.__packageTds(),this._colHidden(!0)
        var t=this.options
        t.colWidthChange&&this.ittab._init(this),t.colHidden&&this.hideCol._init(this),t.colMove&&0===this.theadMap.length&&this.moveCol._init(this)},__getTagsPropertys:function(){for(var t=this.domTh,i=this.options,e=this.colSize,r=this.colStyle,a=this.bindName,o=this.bindDotName,h=this.sort=[],d=this.theadText,n=this.colWidth,l=this.colRender,c=this.fixedFnClick,g=0;e>g;g+=1){var p=t[g]
        n.push(p.style.width||p.getAttribute("width")||""),this.colHidden[g]="true"===p.getAttribute("hide")||"none"===s(p).css("display")
        var u=p.getAttribute("colStyle")||"",f=u.replace(/padding.+?(;|$)/,"").replace(/display\s*?:\s*?none\s*?(;|$)/,"")+";"
        r.push(f)
        var m=p.getAttribute("bindName")||""
        a[g]=m,o[g]=/\./.test(m)?m.split("."):void 0,isNaN(this.numCol)&&m.length&&!isNaN(m-0)&&(this.numCol=g,a[g]=m-0,m=""),h[g]=""===m?!1:"true"===p.getAttribute("sort")||!1,d.push(p.innerHTML)
        var v=p.getAttribute("format"),y=i.cellRender,b=p.getAttribute("render")
        if(l[g]=[],null!==v&&(/money/.test(v)?l[g][1]={format:+(v.split("-")[1]||2),callback:this.formatFn.money}:/(dd|MM|yy)/i.test(v)&&(l[g][1]={format:v,callback:this.formatFn.date})),"function"==typeof y&&(l[g][0]={render:"colrenderFn",callback:y}),"string"==typeof b)if(RegExp(b).test("a;button;image")){var C=p.getAttribute("options")
            if(null!==C)if(/{/.test(C))try{C=JSON.parse(C)}catch(_){C=Function("return "+C+";")()}finally{"object"!=typeof C&&(C=void 0)}else C=window[C]
            if(C){var T=C.click
                T="string"==typeof T?window[T]:T,C.click="function"==typeof T?c.push(T)-1:"",l[g][0]={render:"fiexdFn",method:b,options:C}}}else{var w=window[b]
            if(w){var x={format:v||void 0,render:w,colStyle:u,text:d[g]}
                l[g][0]={render:"renderFn",colJson:x,callback:w}}}}var S=i.selectType;("multi"===S||"single"===S)&&(a[0]=-1)},__initColWidth:function(){for(var t=this.gridWidth,i=this.tableWidth||t,e=this.colWidth,r=this.colWidthBackup,a=0,o=0,h=this.colSize,d=[],n=this.colSize;n--;){var l=e[n]
        r[n]=-1,""===l?(l=0,e[n]=200,d.push(n)):/%/.test(l)?(l=Math.round(i*parseInt(l,10)/100),e[n]=l):(l=parseInt(l,10),e[n]=l),a+=e[n],o+=l}var c=d.length,g=i-o
        if(c>0&&g>c){for(var p=Math.round(g/c),u=0;c>u;u++)e[d[u]]=p
            e[d[u-1]]+=g-p*c,this.tableWidth=i}else if(isNaN(this.tableWidth)&&a>=t)this.tableWidth=a
        else{this.tableWidth||(this.tableWidth=t)
            for(var f=[],m=0,v=0,y=h;y--;){var b=Math.round(e[y]*i/a)
                m+=b,f[y]=b,v=y}f[v]+=i-m,this.colWidth=f}this.initColWidth=s.extend([],this.colWidth)},__renderHead:function(){var t=this.options,i=this.domTh,e=this.theadMap,r=this.theadMap.length,a=this.domHeadCol,o=this.domFixed[0]=[],h=this.theadText,d=this.colSize,n=t.fixedColSize,l=this.options.colHidden,c=this.sort,g=document.createElement("tr"),p=t.headerWrap
        if(g.className="grid-width-norm",r){var u=document.createElement("th")
            u.className="grid-empty-th",g.appendChild(u)
            for(var f=r-1;f--;)for(var m=e[f],v=m.length;v--;){var y=m[v]
                y.removeAttribute("width"),y.style.width=""}}for(var b=0;d>b;b+=1){var C=a[b]=document.createElement("th")
            g.appendChild(C)
            var _=i[b]
            n>b&&s(_).addClass("grid-fixed"),c[b]&&s(_).addClass("grid-sort"),_.removeAttribute("width"),_.style.width=""
            var T=h[b],w=['<div class="grid-fixed-d">','<span class="grid-fixed-s">','<a class="grid-thead-text']
            p||w.push('" title="',s.trim(T.replace(/<.*?>/g,""))),w.push('">',T,"</a>"),l&&w.push('<a class="grid-select"></a>'),w.push('<em class="grid-ittab"></em>'),w.push("</span>"),n>b&&p&&w.push(T),w.push("</div>"),_.innerHTML=w.join("")}this.gridHeadTable.html(this.elCache.find("thead").eq(0).prepend(g)),this.elCache.parent().remove(),delete this.elCache
        for(var x=0;n>x;x+=1)i[x].getElementsByTagName("div")[0].style.zIndex=n+1-x,o.push(i[x].getElementsByTagName("span")[0])
        var S=s(i[0])
        if("multi"===t.selectType){S.find(".grid-select").eq(0).remove(),S.find(".grid-fixed-s").addClass("grid-no-move")
            var k=s(i[0]).find(".grid-thead-text").addClass("grid-all-checkbox")
            k.html("&nbsp;"+k.text()),this.gridAllCheck=k}"single"===t.selectType&&(S.find(".grid-select").eq(0).remove(),S.find(".grid-fixed-s").addClass("grid-no-move"))},__renderBody:function(){var t=this.el,i=this.colSize,e=this.domBodyCol,s=document.createElement("tr")
        s.className="grid-width-norm"
        for(var r=0;i>r;r+=1){var a=e[r]=document.createElement("th")
            s.appendChild(a)}t.html("<thead></thead><tbody></tbody>"),t.find("thead").append(s),this.gridTbody=t.find("tbody").eq(0)},__packageTds:function(){var t=this.options,i=t.fixedColSize,e=this.colStyle,s=t.selectType,r=this.selectrowsClass={none:"",multi:"grid-checkbox",single:"grid-radio"}[s],a=this.colSize,o=""
        this.writeStyle||(o="left:0px;")
        var h=[],d=0
        if(""!==r){d+=1
            var n=h[0]={}
            i>0?(n.html='<div class="grid-fixed-d" style="z-index:'+(i+1)+';"><span class="grid-fixed-s '+r+'" style="'+o+e[0]+'/**/"></span></div>',n.style=""):(n.style=e[0],n.className=r)}for(var l=d;a>l;l+=1){var c=h[l]={}
            i>l?(c.html='<div class="grid-fixed-d" style="z-index:'+(i+1-l)+';"><span class="grid-fixed-s" style="'+o+e[l]+'/**/"><!----></div>',c.style=""):c.style=e[l]}this.tdsPackage=h},_setColWidth:function(t){for(var i=this.initColWidth,e=this.colHidden,s=this.tableWidth,r=this.colSize,a=0,o=r;o--;)e[o]===!1&&(a+=i[o])
        for(var h=[],d=0,n=0,l=r;l--;)if(e[l]===!1){var c=Math.round(i[l]*s/a)
            d+=c,h[l]=c,n=l}else h[l]=0
        h[n]+=s-d,this.colWidth=h,this._setColWidthStyle(),t&&this._isScrolling(!0)},_setColWidthStyle:function(t){var i,e=this.colWidth,s=this.domHeadCol,r=this.domBodyCol,a=this.colSize,o=""
        if("number"==typeof t)i=e[t]-1+"px",s[t].style.width=i,r[t].style.width=i
        else for(;a--;)o=0===e[a]?0:e[a]-1+"px",s[a].style.width=o,r[a].style.width=o},_colHidden:function(t){for(var i=this.endRow,e=this.domTh,s=this.domTd,r=this.tdsPackage,a=this.domHeadCol,o=this.domBodyCol,h=this.colHidden,d=this.colWidth,n=this.colWidthBackup,l=this.tableWidth,c=this.theadMap,g=this.extendTh,p=null,u=null,f=this.colSize;f--;)if(h[f]===!0){if(-1===n[f]||t){if(a[f].style.display="none",u=e[f],c.length)for(var m=c.length;m--;)g[m][f]||(p=c[m][f],p.colSpan>1?p.colSpan--:p.style.display="none")
    else u.style.display="none"
        for(var v=i;v--;)s[v][f].style.display="none"
        o[f].style.display="none",r[f].style+="display:none;",n[f]=d[f],l-=d[f],d[f]=0}}else if(-1!==n[f]){if(a[f].style.display="",u=e[f],c.length)for(var y=c.length;y--;)g[y][f]||(p=c[y][f],"none"===p.style.display?p.style.display="":p.colSpan+=1)
    else u.style.display=""
        for(var b=i;b--;)s[b][f].style.display=""
        o[f].style.display="",r[f].style=r[f].style.replace(/display.*?($|;)/g,""),d[f]=n[f],l+=n[f],n[f]=-1}this.options.adaptive?this.isIttab=!1:this.tableWidth=l,this._setLayout(),this.persistence&&!t&&this._triggerStatusChange()},_triggerStatusChange:function(){var t,i,e,s=this.options,r=this.query,a=this.colWidth,o=this.colWidthBackup,h=this.colHidden,d=this.colIndex,n=!s.adaptive,l=0===this.theadMap.length&&s.colMove,c=0,g=[]
        for(i=this.colSize;i--;)h[i]?(a[i]=o[i],g[i]=1):g[i]=0,c+=a[i]
        e={hide:h,sortName:r.sortName,sortType:r.sortType,overall:c},window.JSON&&JSON.stringify?(l&&(e.index=d),n&&(e.width=a),t=JSON.stringify(e)):t="{"+(l?'"index":['+d.join(",")+"],":"")+(n?'"width":['+a.join(",")+"],":"")+'"hide":['+g.join(",")+'],"sortName":["'+r.sortName.join('","')+'"],"sortType":["'+r.sortType.join('","')+'"],"overall":'+c+"}",this.options.onStateChange(t)},_isScrolling:function(t){var i=this.el,e=this.gridWidth+2,s=this.tableWidth,r=this.boxHeight,a=i.height(),o=this.gridScroll
        this.options.adaptive&&!this.isIttab?(a>r?s=this.tableWidth=e-17:(this.tableWidth=e,s=e+1),i.css("width",s),this.gridHeadTable.css("width",s),o.css("left","-999999px"),t||(this._setColWidth(!0),this._setLayout(!0))):(a>r&&e>=s+17&&(this.gridTableHide.css("marginBottom",0),o.css({left:"-999999px",width:e-17})),s>e&&r>=a+17&&(o.css({width:e,left:0,bottom:""}),o.css("bottom",0),this.gridTableHide.css("marginBottom",17)),(s+17>e&&a>r||s>e&&a+17>r)&&(o.css({width:e-17,left:0,bottom:""}),o.css("bottom",0),this.gridTableHide.css("marginBottom",17)),r>=a&&e>=s&&(this.gridTableHide.css("marginBottom",0),o.css({left:"-999999px",width:e}))),o.find("div").eq(0).css("width",s),clearTimeout(this.sc),this.sc=setTimeout(function(){o.scroll()},10)},_setAutoHeight:function(){var t,i
        if(this.autoHeight){t=this.gridTableBox,i=28
            var e=parseInt(t.css("marginBottom"),10)||1,s=Math.max(t.height()||this.rowSize*i,50)
            this._setHeight(s+e+this.theadHeight+(this.options.pagination&&this.rowSize?41:0)+2)}},_setLayout:function(t){this._setStyleWidth(),(this.options.headerWrap||this.theadMap.length)&&this._setTheadHeight(),this._setStyleHeight(),t||this._isScrolling(),this._setAutoHeight(),this.options.pagination&&this._setPageLayout()},_setTheadHeight:function(){this.gridHead.css("height","auto")
        var t=this.theadHeight=this.gridHead.height()+1,i=this.domFixed[0]
        this.boxHeight=this.gridHeight-this.paginationHeight-t-1,this.gridOverlay.css("height",t)
        for(var e=i.length;e--;){var r=i[e],a=s(r).parent(),o=parseInt(a.parent().height(),10),h=parseInt((o-(a.height()||21))/2,10)
            h=0>h?0:h,r.style.paddingTop=h+"px",r.style.height=o-h+1+"px"}},setConfig:function(t){this.persistence&&this.unRender&&this._setPersistence(t),this.options.datasource(this,this.getQuery())},setDatasource:function(t,i,e){this.persistence&&this.unRender&&"string"==typeof e&&this._setPersistence(e),t=t||[],i=i||0,this.rowSize=t.length,this.data=s.extend(!0,[],t),this.options.pagination&&(this.unRender&&(this.totalSize=i,this.__createPagination()),this.totalSize!==i&&(this.totalSize=i,this._setPageNoList())),this._isEmpty(),this._initProperty(),this._renderTbody(0/0,0/0),this._setLayout(),this._loading("hide"),this._loadComplateCallBack(),this.__setSortStyle(),delete this.unRender},_setPersistence:function(t){var i,e,r,a,o,h,d,n=this.options,l=this.colSize
        if("string"==typeof t){try{i=s.parseJSON(t)}catch(c){}if(i){if(i.overall&&(this.tableWidth=i.overall,this.gridHeadTable.css("width",this.tableWidth)),e=i.index,0===this.theadMap.length&&n.colMove&&"object"==typeof e&&l===e.length&&(this.colIndex=e,this._sortPropertys(e)),this._createPropertys(),r=i.sortName,a=i.sortType,"array"===s.type(r)&&"array"===s.type(a)&&this.setQuery({sortName:r,sortType:a}),o=i.hide,"object"==typeof o&&l===o.length){for(d=0;l>d;d++)o[d]=!!o[d]
            this.colHidden=o}h=i.width,n.adaptive||"object"!=typeof h||l!==h.length||(this.colWidth=h)}else this._createPropertys()}else this._createPropertys()
        this._createContent()},_sortPropertys:function(t){var i,e,s,r,a=this.colSize
        for(e=this.domTh,s=[],i=e[0].parentNode,r=0;a>r;r++)s[r]=e[t[r]],i.appendChild(s[r])
        this.domTh=s},_isEmpty:function(){var t=this.options,i=this.rowSize
        0===i?(this.gridEmpty.show(),this.gridTfoot.hide(),this.gridTableBox.hide(),this.paginationHeight=0):(this.gridEmpty.hide(),this.gridTableBox.show(),t.pagination&&(this.gridTfoot.show(),this.paginationHeight=41)),this.boxHeight=this.gridHeight-this.paginationHeight-this.theadHeight-1},_initProperty:function(){var t=this
        setTimeout(function(){t.gridBody[0].scrollTop=0,t.gridBody.scroll()},10),this.gridTableBox.removeAttr("style"),this.domTr=[],this.domTd=[],this.domFixed.length=1,this.multiChecked=[],this.multiCheckedNum=0,this.singleChecked=0/0,this.odd=!1,this.endRow=0,this.renderComplete=!1,this.gridAllCheck&&this.gridAllCheck.removeClass("grid-all-checkbox-checked"),this.gridTbody.html(""),this.trStart=0,this.trEnd=0},loadData:function(){this._loading("show"),this.options.datasource(this,this.getQuery())},addData:function(t,i){"object"===s.type(t)&&(t=[t])
        var e=t.length
        if(0!==e){if(t=s.extend(!0,[],t),this.unRender)return this.setDatasource(t),void 0
            this._isEmpty()
            var r=this.options.selectType
            "number"==typeof i&&i<this.rowSize?(this._spliceArray(this.data,i,t),"multi"===r?this._spliceArray(this.multiChecked,i,Array(e)):"single"===r&&i<this.singleChecked&&(this.singleChecked+=e)):this.data=this.data.concat(t),this.rowSize+=e,this._isEmpty(),this._renderTbody(e,i),this.options.pagination&&this._setPageNoList(),this._setLayout()
            var a=this.options.addDataCallback
            "function"==typeof a&&a.call(this,t)}},__createPagination:function(){var t,i,e
        this.options.pagination&&(t=this.gridTfoot,e=this.options.recordSizeList,t.html('<div class="grid-page-size">'+('<a href="javascript:;" class="grid-page-size-0">'+e[0]+"</a>")+('<a href="javascript:;" class="grid-page-size-1">'+e[1]+"</a>")+('<a href="javascript:;" class="grid-page-size-2">'+e[2]+"</a>")+'</div><div class="grid-page-to"><input type="text" class="grid-page-to-input"><a href="javascript:;" class="grid-page-go">GO</a></div><div class="grid-pages"><a href="javascript:;" class="grid-page-prev"></a><a href="javascript:;" class="grid-page-no grid-page-no-0">1</a><span>...</span><a href="javascript:;" class="grid-page-no grid-page-no-1"></a><a href="javascript:;" class="grid-page-no grid-page-no-2"></a><a href="javascript:;" class="grid-page-no grid-page-no-3"></a><a href="javascript:;" class="grid-page-no grid-page-no-4"></a><a href="javascript:;" class="grid-page-no grid-page-no-5"></a><span>...</span><a href="javascript:;" class="grid-page-no grid-page-no-6"></a><a href="javascript:;" class="grid-page-next"></a></div>'),i=this,this.paginationPageNo=t.find(".grid-page-no"),this.paginationPageSize=t.find(".grid-page-size").eq(0).find("a"),this.paginationPageEllipsis=t.find("span"),this.paginationGo=t.find(".grid-page-to-input").eq(0),this.paginationPrev=t.find(".grid-page-prev").eq(0),this.paginationNext=t.find(".grid-page-next").eq(0),t.on("click",function(t){var e=t.target,s=e.tagName
            "A"===s&&(i._pageClickHandler(e.className),i.loadData())}),this._setPageNoList())},_pageClickHandler:function(t){var i,e,s,r,a,o=this.query,h=o.pageNo
        return"grid-page-next"===t?(h<(Math.ceil(this.totalSize/o.recordSize)||1)&&(o.pageNo=h+1,this._setPageNoList()),void 0):"grid-page-prev"===t?(h>1&&(o.pageNo=h-1,this._setPageNoList()),void 0):"grid-page-go"===t?(a=this.paginationGo.val().replace(/\s+/g,"")-0,Number.isNaN(a)||a===h||(o.pageNo=a,this._setPageNoList()),void 0):(s=this.options.recordSizeList,r=this.pageNoList,i=(/grid\-page\-size\-(\d)/.exec(t)||[])[1],i&&o.recordSize!==s[i]?(o.recordSize=s[i],this._setPageNoList()):(e=(/grid\-page\-no\-(\d)/.exec(t)||[])[1],e&&h!==r[e]&&(o.pageNo=r[e],this._setPageNoList())),void 0)},_setPageNoList:function(){var t,i,e=this.query,s=e.recordSize,r=this.options.recordSizeList,a=this.paginationPageSize,o=Math.ceil(this.totalSize/s)||1,h=Math.min(e.pageNo,o),d=Math.max(h-2,1),n=Math.min(d+4,o),l=this.pageNoList=[],c=this.paginationPageNo,g=this.paginationPageEllipsis
        for(d=Math.max(n-4,1),e.pageNo=h,d>1&&(l[0]=1),t=d;n>=t;t++)l.push(t)
        for(o>n&&(l[6]=o),t=0;7>t;t++)i=c.eq(t).removeClass("grid-page-checked"),l[t]?(i.show().html(l[t]),l[t]===h&&i.addClass("grid-page-checked")):i.hide()
        for(1===h?this.paginationPrev.addClass("grid-page-prev-disabled"):this.paginationPrev.removeClass("grid-page-prev-disabled"),h===o?this.paginationNext.addClass("grid-page-next-disabled"):this.paginationNext.removeClass("grid-page-next-disabled"),d>2?g.eq(0).show():g.eq(0).hide(),o-1>n?g.eq(1).show():g.eq(1).hide(),t=0;3>t;t++)r[t]===s?a.eq(t).addClass("grid-page-checked"):a.eq(t).removeClass("grid-page-checked")
        this.paginationGo.val(h)},_setPageLayout:function(){var t,i=this.gridTfoot.find("div"),e=this.gridWidth,s=[1,0]
        for(e>597?s=[1,1,1]:508>e&&(s=[0,0]),t=0;2>t;t++)s[t]?i.eq(t).show():i.eq(t).hide()},_spliceArray:function(t,i,e){return Array.prototype.splice.apply(t,[i,0].concat(e)),t},_renderTbody:function(t,i){var e=this.data,s=this.endRow,r=this.rowSize,a=parseInt(this.boxHeight/28,10)+20,o=this.options.wrap
        if(0===r)return this.renderComplete=!0,this.appendRowsComplete=!0,void 0
        if(this.renderComplete=!1,isNaN(t)){var h=Math.min(r,s+a+1)
            o||(this.trEnd=h),this._appendRows(s,h)}else if(this.gridAllCheck&&this.gridAllCheck.removeClass("grid-all-checkbox-checked"),"number"==typeof i&&s>i){for(var d=this.domTr,n=i;s>n;n+=1)d[n].removeAttribute("index")
            var l=d[i],c=this._dataToDom(e,i,i+t),g=c.domTr
            if(this._spliceArray(this.domTr,i,g),this._spliceArray(this.domTd,i,c.domTd),this._spliceArray(this.domFixed,i+1,c.domFixed),i>=this.trStart&&i<this.trEnd||o){for(var p=this.gridTbody[0],u=0;t>u;u+=1)p.insertBefore(g[u],l)
                o||(this.trEnd+=t)}else{i<this.trStart&&!o&&(this.trStart+=t,this.trEnd+=t)
                for(var f=this.trFrag,m=0;t>m;m+=1)f.appendChild(g[m])}this.endRow+=t,this._setAutoHeight(),this._setOddEven(i),this._setNum(i)}else this._lazyload()},_loadComplateCallBack:function(){var t=this.options.loadCompleteCallback
        "function"==typeof t&&t.call(this,this)},__setSortStyle:function(){var t,i,e,s,r,a=this.query,o=a.sortType,h=a.sortName,d=h.length,n=this.bindName,l=this.domTh,c={DESC:"desc",ASC:"asc"}
        t:for(i=this.colSize;i--;)for(s=n[i],e=l[i],t=0;d>t;t++){if(r=e.className.replace(/grid\-sort\-\w+/g,""),h[t]===s){e.className=r+" grid-sort-"+c[o[t]]
            continue t}e.className=r}},_dataToDom:function(t,i,e){for(var s=this.options,r=this.oddEvenClass,a=s.oddEvenRow,o=s.wrap,h=this.colSize,d=this.domTh,n=this.tdsPackage,l=this.bindName,c=this.bindDotName,g=s.fixedColSize,p=this.numCol,u=this.colRender,f=s.rowStyleRender,m=s.cellStyleRender,v="function"==typeof f,y="function"==typeof m,b=this.renderMethod,C=this.heightLight,_=""!==this.selectrowsClass?1:0,T=this.odd,w=s.primaryKey,x="object"==typeof t[0]&&t[0].hasOwnProperty(w),S=this.createDomBox,k=["<table>"],N=i;e>N;N+=1){k.push('<tr class="'),a&&(T&&k.push(r),T=!T),C[N]&&k.push(" grid-highlight"),k.push('"')
        var H=t[N]
        if(x&&H.hasOwnProperty(w)&&(k.push(' pkey="'),k.push(H[w]+""),k.push('"')),v){var z=f(H)
            "string"==typeof z&&k.push(' style="',z,'"')}if(k.push(">"),1===_){var W=n[0]
            k.push('<td class="grid-select-input '),g>0?(k.push("grid-fixed"),k.push('" style="',W.style,'">',W.html,"</td>")):(k.push(W.className),k.push('" style="',W.style,'"></td>'))}for(var B="",A="",E="",R="",M="",L="",P=null,j=null,q=null,D=null,I=_;g>I;I+=1){E=l[I],R=c[I],p===I?M=N+E:E?void 0===R?M=H[E]:(M=H[R[0]],M=M&&"object"==typeof M?M[R[1]]||"":""):M=""
            var F="",O=""
            if(P=u[I],j=P[0],q=P[1],q&&(M=q.callback(M,q.format)||M),j)switch(L=j.render,O=j.method,L){case"colrenderFn":M=j.callback(H,E)||M
                break
                case"renderFn":D=j.colJson,D.el=d[I],D.bindName=E,M=j.callback(H,N,D)||M
                    break
                case"fiexdFn":M=b[O](H,j.options,M)||M}F="button"!==O&&o?M+"</span>"+M:M+"</span>",B=n[I]
            var V=B.html.replace("<!---->",F)
            k.push('<td class="grid-fixed" style="',B.style,'">'),y&&(A=m(H,E),"string"==typeof A&&(V=V.replace("/**/",A))),k.push(V,"</td>")}for(;h>I;I+=1){if(E=l[I],R=c[I],B=n[I],p===I?M=N+E:E?void 0===R?M=H[E]:(M=H[R[0]],M=M&&"object"==typeof M?M[R[1]]||"":""):M="",P=u[I],j=P[0],q=P[1],q&&(M=q.callback(M,q.format)||M),j)switch(L=j.render){case"colrenderFn":M=j.callback(H,E)||M
            break
            case"renderFn":D=j.colJson,D.el=d[I],D.bindName=E,M=j.callback(H,N,D)||M
                break
            case"fiexdFn":M=b[j.method](H,j.options,M)||M}var Q=B.style
            y&&(A=m(H,E),"string"==typeof A&&(Q+=";"+A)),k.push('<td style="',Q,'">',M,"</td>")}k.push("</tr>")}this.odd=T,k.push("</table>"),S.innerHTML=k.join("")
        for(var K=[],J=[],$=[],G=" "+this.selectedRowClass,X=this.multiChecked,Y=this.singleChecked,U=S.getElementsByTagName("table")[0],Z=0,ti=e-i;ti>Z;Z+=1){var ii=U.rows[Z]
            K.push(ii)
            for(var ei=[],si=[],ri=0;h>ri;ri+=1){var ai=ii.cells[ri]
                ei.push(ai),g>ri&&si.push(ai.getElementsByTagName("span")[0])}X[Z+i]&&(ii.className+=G),J.push(ei),$.push(si)}if(!isNaN(Y)&&Y>=i&&e>Y){var oi=U.rows[Y-i]
            oi.className+=G}return{domTd:J,domTr:K,domFixed:$}},_appendRows:function(t,i){var e=this.rowSize;(this.autoHeight||!this.options.lazy)&&(i=e),i=this.endRow=Math.min(e,i)
        var s=this._dataToDom(this.data,t,i)
        this.domTr=this.domTr.concat(s.domTr),this.domTd=this.domTd.concat(s.domTd),this.domFixed=this.domFixed.concat(s.domFixed)
        for(var r=this.domTr,a=this.gridTbody[0],o=t;i>o;o+=1)a.appendChild(r[o])
        this.gridTableBox.css("paddingBottom",28*(e-i)),this.renderComplete=i===e,this.appendRowsComplete=!0,this._setAutoHeight()},_setOddEven:function(t){var i=this.options
        if(i.oddEvenRow)for(var e=this.domTr,r=this.endRow,a=this.oddEvenClass,o=this.odd=t%2===0,h=t;r>h;h+=1)o?s(e[h]).removeClass(a):s(e[h]).addClass(a),o=!o},_setNum:function(t){if(!isNaN(this.numCol)){var i=this.domTd,e=this.domFixed,s=this.numCol,r=this.bindName[s],a=t,o=this.endRow
        if(this.options.fixedColSize>s)for(;o>a;a+=1){var h=e[a+1][s],d=a+r
            h.innerHTML=d,h.nextSibling.nodeValue=d}else for(;o>a;a+=1)i[a][s].innerHTML=a+r}},hideCols:function(t){if("object"===s.type(t)){for(var i=this.colHidden,e=this.colSize,r=this.bindName,a=0;e>a;a+=1){var o=t[r[a]]
        "boolean"==typeof o&&(i[a]=o)}this._colHidden(!1)}},getQuery:function(){var t=s.extend(!0,{},this.query),i=this.customQuery
        return i?(i.recordSize=t.recordSize,i.pageNo=t.pageNo,i.sortName=s.extend([],t.sortName),i.sortType=s.extend([],t.sortType),i):t},setQuery:function(t){"object"==typeof t&&(this.customQuery=t),t=t||this.backupQuery
        var i=this.options.sortColSize,e=this.query
        "number"==typeof t.recordSize&&(e.recordSize=t.recordSize),"number"==typeof t.pageNo&&(e.pageNo=t.pageNo),"array"===s.type(t.sortName)&&(e.sortName=s.extend([],t.sortName),e.sortName.length>i&&(e.sortName.length=i)),"array"===s.type(t.sortType)&&(e.sortType=s.extend([],t.sortType),e.sortType.length>i&&(e.sortType.length=i)),this._setRecordSize(),this._setSortTypeObj()},_setHeight:function(t){return"number"!=typeof t||t-2===this.gridHeight?!1:(t-=2,this.boxHeight-=this.gridHeight-t,this.gridHeight=t,this._lazyload(),this._setLayout(),this.options.colHidden&&this.hideCol.hideCol&&this.hideCol.hideCol.blur(),!0)},setHeight:function(t){this.autoHeight=!this._setHeight(t)},setWidth:function(t){if("number"==typeof t&&t-2!==this.gridWidth){var i=this.ittab
        i&&i.ittabActive||(t-=2,this.options.adaptive&&(this.tableWidth=t-17,this.isIttab=!1),this.gridWidth=t,this._setLayout(),this.options.colHidden&&this.hideCol.hideCol&&this.hideCol.hideCol.blur())}},setHighLight:function(t,i){var e=this.options.primaryKey,r=this.data,a=this.endRow
        if(r[0]&&r[0].hasOwnProperty(e))for(var o=this.rowSize;o--;)if(r[o][e]===t){a>o&&(i!==!1?s(this.domTr[o]).addClass("grid-highlight"):s(this.domTr[o]).removeClass("grid-highlight")),this.heightLight[o]=i!==!1
            break}},selectRowsByIndex:function(t,i){i=i!==!1
        var e,s,r=this.options.selectType,a=this.data,o=[]
        if("none"===r||t>=this.rowSize)return[]
        if(i!==!1&&(i=!0),"number"==typeof t&&(t=[t]),"single"===r)e=t[0],e>-1&&(this._selectRows(e,i),o.push(a[e]))
        else for(var h=0,d=t.length;d>h;h+=1)s=t[h],this._selectRows(s,i),o.push(a[s])
        return o},_pkToIndex:function(t,i){var e=this.data,r=this.rowSize,a=this.options.primaryKey
        if(e[0].hasOwnProperty(a)===!1||void 0===t)return[]
        "array"!==s.type(t)&&(t=[t])
        for(var o=t.length,h=[],d=0;o>d;d+=1){for(var n=t[d],l=!1,c=r;c--;)if(e[c][a]===n){h.push(c),l=!0
            break}!l&&i&&h.push(-1)}return h},selectRowsByPK:function(t,i){var e=this.options
        return-1!=="array string number".indexOf(s.type(t))&&"none"!==e.selectType&&this.rowSize&&this.data[0].hasOwnProperty(e.primaryKey)!==!1?this.selectRowsByIndex(this._pkToIndex(t,!0),i):[]},_removeRow:function(t){var i=this.data,e=i[t]
        return this.data.splice(t,1),s(this.domTr[t]).remove(),this.domTr.splice(t,1),this.domTd.splice(t,1),this.multiChecked.splice(t,1),this.singleChecked>t&&this.singleChecked--,this.domFixed.splice(t+1,1),e},removeData:function(t){if("number"==typeof t||"array"===s.type(t)){"number"==typeof t&&(t=[t]),t.sort(function(t,i){return t-i})
        for(var i=t.length,e=[],r=this.singleChecked,a=this.multiChecked,o=this.options,h=o.selectType,d=o.wrap,n=this.endRow,l=0;i>l;l+=1){var c=t[l]-l,g=this.rowSize
            if(isNaN(c)||c>=g){t[l]=0
                break}this.rowSize=g-1,n>c&&(d||(c<this.trEnd&&this.trEnd--,c<this.trStart&&this.trStart--),this.endRow--),"multi"===h?a[c]===!0&&this.multiCheckedNum--:"single"===h&&r===c&&(this.singleChecked=0/0)
            var p=this._removeRow(c)
            p&&e.push(p)}var u=this.rowSize
        if(0>=u)this.query.pageNo>1&&(this.query.pageNo-=1),this.rowSize=0,this._isEmpty()
        else{"multi"===o.selectType&&(this.multiCheckedNum===u?this.gridAllCheck.addClass("grid-all-checkbox-checked"):this.gridAllCheck.removeClass("grid-all-checkbox-checked"))
            for(var f=this.domTr,m=this.endRow;m--;)f[m].removeAttribute("index")
            var v=t[0]-0
            this._setOddEven(v),this._setNum(v),this._lazyload()}this._setLayout()
        var y=o.removedataCallback
        "function"==typeof y&&y.call(this,e)}},removeDataByPk:function(t){this.removeData(this._pkToIndex(t,!1))},changeData:function(t,i){if("object"===s.type(t)){var e=this.options,r=e.primaryKey,a=t[r]
        if(void 0!==a){var o=this._pkToIndex(a,!1)[0]
            i=void 0===o?i:o}if(!("number"!=typeof i||0>i||i>=this.rowSize||(this.data[i]=s.extend(!0,this.data[i],t),i>=this.endRow))){var h=this._dataToDom([t],0,1),d=h.domTd[0],n=this.domTd[i],l=this.bindName,c=e.fixedColSize
            this.odd=!this.odd
            for(var g=this.colSize;g--;){var p=l[g],u=s(n[g])
                if(u.removeAttr("title"),c>g){if("number"!=typeof p){var f=u.find(".grid-fixed-s")[0],m=s(d[g]).find(".grid-fixed-s")[0].innerHTML
                    f.innerHTML=m,f.nextSibling.nodeValue=m}}else"number"!=typeof p&&u.html(d[g].innerHTML)}}}},getData:function(){return s.extend(!0,[],this.data)},getSelectedData:function(){var t=this.options.selectType
        if("none"===t)return[]
        var i=this.data
        if("single"===t)return isNaN(this.singleChecked)?[]:[i[this.singleChecked]]
        if(this.multiCheckedNum===this.rowSize)return this.data
        for(var e=this.multiChecked,s=this.rowSize,r=[],a=0;s>a;a+=1)e[a]&&r.push(i[a])
        return r},getSelectedPK:function(){var t=this.options,i=t.selectType,e=t.primaryKey,s=this.getSelectedData(),r=s.length
        if("none"===i||!r||s[0].hasOwnProperty(e)===!1)return[]
        for(var a=[],o=0;r>o;o+=1)a.push(s[o][e])
        return a},getSelectedIndex:function(){var t=this.options.selectType
        if("none"===t)return[]
        if("single"===t)return[this.singleChecked]
        for(var i=this.multiChecked,e=this.rowSize,s=[],r=0;e>r;r+=1)i[r]&&s.push(r)
        return s},getDataByIndex:function(t){var i=this.data
        if("number"==typeof t)return[i[t]]
        if("array"===s.type(t)){for(var e=t.length,r=[],a=0;e>a;a+=1){var o=i[t[a]]
            o&&r.push(o)}return r}},getDataByPK:function(t){var i=this.options.primaryKey,e=this.data
        if(e[0]&&e[0].hasOwnProperty(i)){"array"!==s.type(t)&&(t=[t])
            for(var r=t.length,a=[],o=0;r>o;o+=1)for(var h=t[o],d=this.rowSize;d--;)if(e[d][i]===h){a.push(e[d])
                break}return a}return null},_switchCol:function(t,i){var e=this.domHeadCol,r=this.domBodyCol,a=this.domTd,o=this.domTh,h=this.domFixed,d=this.domTr,n=this.options.fixedColSize,l=this.numCol
        this._switchArrayValue(this.bindName,t,i),this._switchArrayValue(this.bindDotName,t,i),this._switchArrayValue(this.colIndex,t,i),this._switchArrayValue(this.theadText,t,i),this._switchArrayValue(this.colStyle,t,i),this._switchArrayValue(this.colRender,t,i),this._switchArrayValue(this.colWidth,t,i),this._switchArrayValue(this.initColWidth,t,i),this._switchArrayValue(this.colWidthBackup,t,i),this._switchArrayValue(this.colHidden,t,i),this._switchArrayValue(this.tdsPackage,t,i),isNaN(l)||(t===l?this.numCol=i-(t>i?0:1):t>l&&l>=i?this.numCol=l+1:l>t&&i>l&&(this.numCol=l-1))
        var c=null,g=this.endRow,p=this.hideCol,u=p.domA,f=p.gridHidecolList
        if(i===this.colSize){var m=s(o[t])
            m.appendTo(m.parent())
            var v=s(r[t])
            v.appendTo(v.parent())
            var y=s(e[t])
            for(y.appendTo(y.parent());g--;)c=a[g],d[g].appendChild(c[t]),this._switchArrayValue(c,t,i)
            f&&(""!==this.selectrowsClass?f.appendChild(u[t-1]):f.appendChild(u[t]))}else{for(s(o[t]).insertBefore(o[i]),s(r[t]).insertBefore(r[i]),s(e[t]).insertBefore(e[i]);g--;)c=a[g],d[g].insertBefore(c[t],c[i]),this._switchArrayValue(c,t,i)
            f&&(""!==this.selectrowsClass?f.insertBefore(u[t-1],u[i-1]):f.insertBefore(u[t],u[i]))}if(this._switchArrayValue(o,t,i),n>t||n>i){var b=Math.min(t,i),C=Math.max(t,i)
            n++
            for(var _=0,T=this.rowSize+1;T>_;_++){this._switchArrayValue(h[_],t,i)
                for(var w=b;C>=w;w++)s(h[_][w]).parent().css("zIndex",n-w)}}this._switchArrayValue(r,t,i),this._switchArrayValue(e,t,i),this.persistence&&this._triggerStatusChange()},_switchArrayValue:function(t,i,e){t.length<e&&(t[e]=void 0),i>e?t.splice(e,0,t.splice(i,1)[0]):t.splice(e-1,0,t.splice(i,1)[0])},ittab:{ittabActive:!1,_init:function(t){var i=this,e=t.gridOverlay,r=t.gridLine,a=[],o=0,h=0,d=!0,n=0/0,l=t.options.adaptive
        t.gridHeadTable.find(".grid-ittab").show(),t.gridHeadTable.on("mousedown",function(i){var l=i.target
            if(h=0,"grid-ittab"===l.className){a=t.colWidth,n=t._thIndex(s(l).parents("th")[0]),e.show().css("cursor","col-resize")
                var c=e.offset().left
                o=i.pageX-c,r.show().css("left",o),d=!1,e.off("mousemove").on("mousemove",function(t){return t.stopPropagation(),h=t.pageX-c,a[n]+h-o<24&&(h=24+o-a[n]),r.css("left",h),!1})}return!1}),e.on("mouseup mouseout",function(){if(!d&&!isNaN(n)&&(d=!0,s(this).hide(),r.hide(),0!==h)){var e=h-o
            t.isIttab=!0,t.colWidth[n]=a[n]+e,t.tableWidth=t.tableWidth+e,i.ittabActive=!0,t._setColWidthStyle(l?void 0:n),t.persistence&&t._triggerStatusChange(),t._setLayout(),i.ittabActive=!1,o=h=0,n=0/0}})}},hideCol:{_init:function(t){var i=this.hideCol=document.createElement("div")
        i.className="grid-hidecol"
        var e=t.theadHeight
        i.style.top=e+"px",i.tabIndex="1",t.gridContainer.append(i),i=s(i)
        var r=t.colSize,a=t.theadText,o="",h=0
        ""!==t.selectrowsClass&&(h+=1)
        for(var d=['<div class="grid-hidecol-list" hidefocus="true" >'];r>h;h+=1)o=s.trim(a[h].replace(/<.*?>/g,"")),d.push('<a href="javascript:;" hidefocus="true" title=',o,">",o,"</a>")
        d.push("</div>",'<div class="grid-hidecol-button">','<a href="javascript:;" hidefocus="true" class="cui-button blue-button grid-hidecol-confirm">确定</a>','<a href="javascript:;" hidefocus="true" class="cui-button red-button grid-hidecol-cancel">取消</a>',"</div>"),i.html(d.join("")),this.gridHidecolList=i.find(".grid-hidecol-list")[0],this.domA=this.gridHidecolList.getElementsByTagName("a"),this.bindEvent(t,i)},bindEvent:function(t,i){function e(){for(var t=l;o>t;t+=1)p[t]?s(g[t-l]).addClass("grid-hidecol-nochecked"):s(g[t-l]).removeClass("grid-hidecol-nochecked")}{var r,a,o=t.colSize,h=t.gridBox,d=null,n=!1,l=0,c=-1,g=this.domA
        document.createElement("span")}""!==t.selectrowsClass&&(l+=1),t.gridHeadTable.on("click",function(p){var u=p.target
        if(r=h.offset().left,a=r+t.gridWidth/2,"grid-select"===u.className){d&&i.blur(),d=s(u).parents("th").addClass("grid-thead-select")
            var f=s(u).offset().left,m=f-r+2
            f>a&&(m-=126)
            var v=Math.max(t.boxHeight-t.theadHeight-41,60)
            22*o>v?i.children(".grid-hidecol-list").css("height",v):i.children(".grid-hidecol-list").css("height",""),i.css({left:m,top:t.theadHeight}).show().focus().attr("hidefocus","true"),e()
            var y=t._thIndex(d[0])-l
            s(g[c]).removeClass("grid-hidecol-disabled"),s(g[y]).addClass("grid-hidecol-disabled"),c=y,n=!1}else s(i).blur()}),i.on("blur",function(){return n?(i.focus(),void 0):(d&&d.removeClass("grid-thead-select"),s(i).hide(),void 0)}),i.on("mouseover",function(){n=!0}),i.on("mouseout",function(){n=!1})
        var p=t.colHidden
        i.on("click",function(i){var r=s(i.target)
            if(r.hasClass("grid-hidecol-confirm")){for(var a=l;o>a;a+=1)p[a]=s(g[a-l]).hasClass("grid-hidecol-nochecked")
                return n=!1,t._colHidden(!1),s(this).blur(),!1}return r.hasClass("grid-hidecol-cancel")?(e(),n=!1,s(this).blur(),!1):"A"===r.prop("tagName")?(r.hasClass("grid-hidecol-disabled")||r.toggleClass("grid-hidecol-nochecked"),!1):(this.focus(),void 0)}),setTimeout(e,100)}},moveCol:{_init:function(t){var i=s("<div>"),e=s("<div>"),r=t.gridHeadTable.addClass("grid-col-move")
        i.addClass("grid-col-move-insert").html("<span></span>"),e.addClass("grid-col-move-tag"),t.gridHead.append(e).append(i)
        var a=t.options,o=t.gridOverlay,h=a.fixedColSize,d=t.selectrowsClass,n=null,l=0,c=[],g=[],p=0/0,u=0/0,f=!1,m=!0
        r.on("mousedown",function(v){var y=s(v.target)
            if(y.hasClass("grid-fixed-s")&&!y.hasClass("grid-no-move")){a.colHidden&&t.hideCol.hideCol.blur(),m=!1,n=t.colHidden
                var b=t.colWidth,C=t.colSize,_=t.domTh,T=t.domFixed[0],w=Math.round(r.offset().left),x=t.gridScroll[0].scrollLeft,S=0,k=t.theadHeight,N=y.parent().parent()
                p=t._thIndex(N[0]),l=0,c=[],g=[]
                var H=0,z=null,W=0,B=0
                if(h>p){for(f=!0;h>H;H+=1)z=b[H],l+=z,W=Math.round(s(T[H]).offset().left)-w-x,n[H]===!0&&(W=-100),c.push(W),g.push(W),n[H]||(g[H]=W+z/2)
                    c.push(l-x),g.push(l-x-1),d&&(c[0]=g[0]=-100),B=c[p]-1}else{for(f=!1,H=h;C>H;H+=1)z=b[H],W=Math.round(s(_[H]).offset().left)-w-x,n[H]===!0&&(W=-100),c.push(W),g.push(W),n[H]||(g[H-h]=W+z/2)
                    c.push(t.tableWidth-x),g.push(t.tableWidth-x-1),0===h&&d&&(c[0]=g[0]=-100),B=c[p-h]-1}e.show().css({left:B,width:N.width(),height:k-2,lineHeight:k-2+"px"}).html(y.find(".grid-thead-text").eq(0).html()),i.show().css("height",k-1),o.show().css("cursor","move")
                var A=v.pageX
                return i.css("left",-1e3),o.off("mousemove").on("mousemove",function(t){t.stopPropagation(),S=t.pageX,e.css("left",B-A+S)
                    for(var s=g.length,r=0;s>r;r+=1){var a=g[r]
                        if(!(0>a)&&a>S){i.css("left",c[r]),u=f?r:r+h
                            break}}return!1}),!1}}),o.on("mouseup",function(){if(!m&&(m=!0,o.hide(),i.hide(),e.hide(),!isNaN(u)&&!isNaN(p)&&u!==p&&u!==p+1)){if(p>u)return t._switchCol(p,u),u=p=0/0,void 0
            for(var s=p+1;u>s;s+=1)if(!n[s]){t._switchCol(p,u),u=p=0/0
                break}}}),o.on("mouseout",function(){o.hide(),i.hide(),e.hide(),u=p=0/0})}}})}(window)
